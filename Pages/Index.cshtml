@page
@model DisasterAlleviation.Pages.IndexModel
@{
    ViewData["Title"] = "Home";
}

<!-- Hero Section -->
<section class="hero">
    <div class="hero-overlay">
        <div class="container text-center">
            <h1 class="hero-title">
                Bringing Hope in <span class="highlight">Times of Crisis</span>
            </h1>
            <p class="hero-sub">
                The Disaster Alleviation Foundation provides practical aid during disasters, ensuring
                transparency and swift action when communities need it most.
            </p>
            <a href="/Donate" class="btn btn-primary btn-lg">Donate Now</a>
        </div>
    </div>
</section>

<!-- Impact Section -->
<section class="impact-section">
    <div class="container text-center">
        <h2 class="section-title">Our Impact by the Numbers</h2>
        <p class="section-sub">
            Transparency is at the core of our mission. Here’s how your donations are making a real difference.
        </p>

        <div class="impact-grid">
            <div class="impact-card">
                <h3 class="impact-title">Total Money Donations</h3>
                <p class="impact-value">R @Model.TotalMoneyDonations</p>
                <p class="impact-foot">Received from generous donors</p>
            </div>

            <div class="impact-card">
                <h3 class="impact-title">Goods Received</h3>
                <p class="impact-value">@Model.TotalGoodsReceived</p>
                <p class="impact-foot">Items donated for distribution</p>
            </div>

            <div class="impact-card">
                <h3 class="impact-title">Total Donors</h3>
                <p class="impact-value">@Model.TotalDonors</p>
                <p class="impact-foot">Supporting our mission</p>
            </div>
        </div>
    </div>
</section>

<!-- Current Disasters -->
<!-- Current Disasters -->
<section class="current-disasters">
    <div class="container text-center">
        <h2 class="section-title">Current Disaster Response</h2>
        <p class="section-sub">
            See how resources are being allocated to help communities in crisis right now.
        </p>

        @if (Model.ActiveDisasters.Any())
        {
            <div id="disasterGrid" class="disaster-grid">
                @foreach (var disaster in Model.ActiveDisasters)
                {
                    <div class="disaster-card">
                        <h3 class="disaster-title">@disaster.TypeOfDisaster</h3>

                        <div class="disaster-meta">
                            <p><i class="bi bi-geo-alt"></i> @disaster.Location</p>
                            <p><i class="bi bi-calendar-event"></i> @disaster.StartDate.ToString("yyyy-MM-dd")</p>
                        </div>

                        <p class="disaster-desc">@disaster.Description</p>

                        @if (!string.IsNullOrEmpty(disaster.RequiredAidTypes))
                        {
                            <div class="aid-tags">
                                @foreach (var aid in disaster.RequiredAidTypes.Split(','))
                                {
                                    <span class="aid-tag">@aid.Trim()</span>
                                }
                            </div>
                        }

                        <div class="allocation-summary">
                            <p><strong>Status:</strong> @disaster.Status</p>
                        </div>
                    </div>
                }
            </div>

            <button id="toggleDisastersBtn" class="btn btn-outline-primary mt-4">View All Disasters</button>
        }
        else
        {
            <div class="no-disasters">
                <div class="no-icon">⚠️</div>
                <p class="no-text">No active disasters at this time.</p>
            </div>
        }
    </div>
</section>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const grid = document.getElementById("disasterGrid");
        const cards = Array.from(grid.children);
        const toggleBtn = document.getElementById("toggleDisastersBtn");
        const maxVisible = 3;

        // Initially show only top 3
        cards.forEach((card, index) => {
            if (index >= maxVisible) card.style.display = "none";
        });

        let expanded = false;

        toggleBtn?.addEventListener("click", () => {
            expanded = !expanded;
            cards.forEach((card, index) => {
                card.style.display = expanded || index < maxVisible ? "block" : "none";
            });

            toggleBtn.textContent = expanded ? "Show Less" : "View All Disasters";
        });
    });
</script>

@section Scripts {
    <script>
        function toggleMoreDisasters() {
            const moreSection = document.getElementById('moreDisasters');
            const btn = document.getElementById('toggleViewBtn');
            if (moreSection.style.display === 'none') {
                moreSection.style.display = 'grid';
                btn.textContent = 'Show Less';
                btn.classList.add('btn-secondary');
            } else {
                moreSection.style.display = 'none';
                btn.textContent = 'View All Disasters';
                btn.classList.remove('btn-secondary');
            }
        }
    </script>
}

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

@if (TempData["AnonId"] != null)
{
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            Swal.fire({
                title: "Thank You for Your Donation!",
                html: `
                    <p>Your <strong>Anonymous Donor ID</strong> is:</p>
                    <h3 style="color:#3085d6; font-weight:bold;">@TempData["AnonId"]</h3>
                    <p>Please save this ID to use for future donations.</p>
                `,
                icon: "success",
                confirmButtonText: "Got it",
                confirmButtonColor: "#3085d6",
                allowOutsideClick: false
            });
        });
    </script>
}
@if (TempData["VolunteerSuccess"] != null)
{
    <script>
        Swal.fire({
            icon: 'success',
            title: 'Application Submitted!',
            text: '@TempData["VolunteerSuccess"]',
            confirmButtonColor: '#6c63ff'
        });
    </script>
}

