@page
@model DisasterAlleviation.Pages.VolunteerModel
@{
    ViewData["Title"] = "Volunteer";
}

@if (TempData["VolunteerSuccess"] != null)
{
    <meta name="notification-type" content="volunteer" />
    <meta name="notification-message" content="@TempData["VolunteerSuccess"]" />
}

<section class="container-xl py-5">
    @if (User.IsInRole("Admin") || (Request.Headers["Referer"].ToString().Contains("/Admin")))
    {
        <div class="mb-3">
            <a asp-page="/Admin/AdminDashboard"
               class="btn btn-light border rounded-pill px-3 py-1 small fw-semibold text-secondary back-btn">
                <i class="bi bi-arrow-left-circle me-1"></i> Back to Admin
            </a>
        </div>
    }
    <div class="text-center mb-4">
        <h2 class="text-center mb-4">Become a Volunteer</h2>
        <p class="text-center text-muted mb-5">
            Join our team of dedicated volunteers and make a difference in disaster relief efforts.
            Your time and skills can save lives and rebuild communities.
        </p>
    </div>

    <form method="post" class="shadow p-4 rounded bg-white">
        <h4 class="mb-3"><i class="bi bi-person-heart"></i> Volunteer Application</h4>

        <!-- Personal Information -->
        <div class="row mb-3">
            <div class="col-md-6">
                <label asp-for="Input.FullName" class="form-label fw-semibold"> Full Name <span>*</span></label>
                <input asp-for="Input.FullName" class="form-control" placeholder="Enter your full name" />
                <span asp-validation-for="Input.FullName" class="text-danger"></span>
            </div>
            <div class="col-md-6">
                <label asp-for="Input.Email" class="form-label fw-semibold"> Email <span>*</span></label>
                <input asp-for="Input.Email" class="form-control" placeholder="your.email@example.com" />
                <span asp-validation-for="Input.Email" class="text-danger"></span>
            </div>
        </div>

        <div class="row mb-3">
            <div class="col-md-6">
                <label asp-for="Input.PhoneNumber" class="form-label fw-semibold"> Phone Number <span>*</span></label>
                <input asp-for="Input.PhoneNumber" class="form-control" placeholder="+27 123-4567" />
                <span asp-validation-for="Input.PhoneNumber" class="text-danger"></span>
            </div>
            <div class="col-md-6">
                <label asp-for="Input.Location" class="form-label fw-semibold">Location <span>*</span></label>
                <input asp-for="Input.Location"
                       id="Location"
                       class="form-control"
                       placeholder="Start typing your city (e.g., Polokwane, Johannesburg)"
                       autocomplete="off" />
                <span asp-validation-for="Input.Location" class="text-danger"></span>
            </div>
        </div>

        <!-- Availability & Skills -->
        <div class="mb-3">
            <label asp-for="Input.Availability" class="form-label fw-semibold">Availability <span>*</span></label>
            <select asp-for="Input.Availability" class="form-select">
                <option value="">Select your availability</option>
                <option>Morning (6AM - 12PM)</option>
                <option>Afternoon (12PM - 6PM)</option>
                <option>Evening (6PM - 10PM)</option>
                <option>Weekdays</option>
                <option>Weekends</option>
            </select>
            <span asp-validation-for="Input.Availability" class="text-danger"></span>
        </div>

        <div class="mb-3">
            <label asp-for="Input.Skills" class="form-label fw-semibold"></label>
            <textarea asp-for="Input.Skills" class="form-control" placeholder="e.g., medical training, logistics, translation..." rows="2"></textarea>
            <span asp-validation-for="Input.Skills" class="text-danger"></span>
        </div>

        <!-- Previous Experience -->
        <div class="mb-3">
            <label asp-for="Input.PreviousExperience" class="form-label fw-semibold"></label>
            <textarea asp-for="Input.PreviousExperience" class="form-control" placeholder="Tell us about your past volunteer work..." rows="2"></textarea>
        </div>

        <!-- Available Dates -->
        <div class="row mb-3">
            <div class="col-md-6">
                <label asp-for="Input.AvailableFromDate" class="form-label fw-semibold">
                    Available From *
                </label>
                <input asp-for="Input.AvailableFromDate"
                       type="date"
                       class="form-control"
                       id="availableFrom"
                       required />
                <span asp-validation-for="Input.AvailableFromDate" class="text-danger"></span>
            </div>
            <div class="col-md-6">
                <label asp-for="Input.AvailableUntilDate" class="form-label fw-semibold">
                    Available Until *
                </label>
                <input asp-for="Input.AvailableUntilDate"
                       type="date"
                       class="form-control"
                       id="availableUntil"
                       required />
                <span asp-validation-for="Input.AvailableUntilDate" class="text-danger"></span>
                <small class="text-muted">End date must be after start date</small>
            </div>
        </div>
        <!-- Additional Info -->
        <div class="mb-3">
            <label asp-for="Input.EmergencyContact" class="form-label fw-semibold">Emergency Contact <span>*</span></label>
            <input asp-for="Input.EmergencyContact" class="form-control" placeholder="Name and phone number" />
            <span asp-validation-for="Input.EmergencyContact" class="text-danger"></span>
        </div>

        <div class="form-check mb-2">
            <input asp-for="Input.HasTransportation" class="form-check-input" type="checkbox" />
            <label class="form-check-label" asp-for="Input.HasTransportation">I have reliable transportation</label>
        </div>

        <div class="form-check mb-3">
            <input asp-for="Input.WillingToTravel" class="form-check-input" type="checkbox" />
            <label class="form-check-label" asp-for="Input.WillingToTravel">I am willing to travel for disaster response</label>
        </div>

        <div class="mb-4">
            <label asp-for="Input.AdditionalInfo" class="form-label fw-semibold"></label>
            <textarea asp-for="Input.AdditionalInfo" class="form-control" placeholder="Any motivation, special circumstances, or questions..." rows="2"></textarea>
        </div>

        <button type="submit" class="btn btn-primary w-100 py-2 fw-semibold">Submit Volunteer Application</button>
    </form>
</section>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
         // Date range validation
        const fromDateInput = document.getElementById('availableFrom');
        const untilDateInput = document.getElementById('availableUntil');

        if (fromDateInput && untilDateInput) {
            // Set minimum date to today
            const today = new Date().toISOString().split('T')[0];
            fromDateInput.min = today;
            untilDateInput.min = today;

            // Validate that end date is after start date
            fromDateInput.addEventListener('change', function() {
                untilDateInput.min = this.value;
                if (untilDateInput.value && untilDateInput.value < this.value) {
                    untilDateInput.value = '';
                    alert('End date must be after start date');
                }
            });

            untilDateInput.addEventListener('change', function() {
                if (fromDateInput.value && this.value < fromDateInput.value) {
                    this.value = '';
                    alert('End date must be after start date');
                }
            });
        }
    </script>
}